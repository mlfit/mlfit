<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Implementation of Algorithms that Extend Iterative Proportional Fitting to Nested Structures • mlfit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Implementation of Algorithms that Extend Iterative Proportional Fitting to Nested Structures">
<meta property="og:description" content='The Iterative Proportional Fitting (IPF) algorithm operates on count data. This package offers
    implementations for several algorithms that extend this to nested structures:
    "parent" and "child" items for both of which constraints can be provided.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mlfit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlfit/mlfit/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<p>Implementation of algorithms that extend Iterative Proportional Fitting (IPF) to nested structures.</p>
<p>The IPF algorithm operates on count data. This package offers implementations for several algorithms that extend this to nested structures: “parent” and “child” items for both of which constraints can be provided.</p>
<div id="example---single-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#example---single-zone" class="anchor" aria-hidden="true"></a>Example - single zone</h2>
<p>Here is a multi-level fitting example with a reference sample (<code>reference_sample</code>) and two control tables (<code>individual_control</code> and <code>group_control</code>). Each row of <code>reference_sample</code> represents an individual in a sample of a population, where <code>HHNR</code> is their group ID and <code>PNR</code> is their individual ID, <code>APER</code> and <code>WKSTAT</code> are individial-level charateristics, and <code>CAR</code> is the only household characteristic of the sample population. The ‘N’ columns in both control tables denote how many units of individuals or groups belong to each category.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlfit.github.io/mlfit/" class="external-link">mlfit</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>

<span class="va">reference_sample</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">HHNR</span>, <span class="op">~</span><span class="va">PNR</span>, <span class="op">~</span><span class="va">APER</span>, <span class="op">~</span><span class="va">CAR</span>, <span class="op">~</span><span class="va">WKSTAT</span>,
     <span class="fl">1L</span>,   <span class="fl">1L</span>,    <span class="fl">3L</span>,  <span class="st">"0"</span>,     <span class="st">"1"</span>,
     <span class="fl">1L</span>,   <span class="fl">2L</span>,    <span class="fl">3L</span>,  <span class="st">"0"</span>,     <span class="st">"2"</span>,
     <span class="fl">1L</span>,   <span class="fl">3L</span>,    <span class="fl">3L</span>,  <span class="st">"0"</span>,     <span class="st">"3"</span>,
     <span class="fl">2L</span>,   <span class="fl">4L</span>,    <span class="fl">2L</span>,  <span class="st">"0"</span>,     <span class="st">"1"</span>,
     <span class="fl">2L</span>,   <span class="fl">5L</span>,    <span class="fl">2L</span>,  <span class="st">"0"</span>,     <span class="st">"3"</span>,
     <span class="fl">3L</span>,   <span class="fl">6L</span>,    <span class="fl">3L</span>,  <span class="st">"0"</span>,     <span class="st">"1"</span>,
     <span class="fl">3L</span>,   <span class="fl">7L</span>,    <span class="fl">3L</span>,  <span class="st">"0"</span>,     <span class="st">"1"</span>,
     <span class="fl">3L</span>,   <span class="fl">8L</span>,    <span class="fl">3L</span>,  <span class="st">"0"</span>,     <span class="st">"2"</span>,
     <span class="fl">4L</span>,   <span class="fl">9L</span>,    <span class="fl">3L</span>,  <span class="st">"1"</span>,     <span class="st">"1"</span>,
     <span class="fl">4L</span>,  <span class="fl">10L</span>,    <span class="fl">3L</span>,  <span class="st">"1"</span>,     <span class="st">"3"</span>,
     <span class="fl">4L</span>,  <span class="fl">11L</span>,    <span class="fl">3L</span>,  <span class="st">"1"</span>,     <span class="st">"3"</span>,
     <span class="fl">5L</span>,  <span class="fl">12L</span>,    <span class="fl">3L</span>,  <span class="st">"1"</span>,     <span class="st">"2"</span>,
     <span class="fl">5L</span>,  <span class="fl">13L</span>,    <span class="fl">3L</span>,  <span class="st">"1"</span>,     <span class="st">"2"</span>,
     <span class="fl">5L</span>,  <span class="fl">14L</span>,    <span class="fl">3L</span>,  <span class="st">"1"</span>,     <span class="st">"3"</span>,
     <span class="fl">6L</span>,  <span class="fl">15L</span>,    <span class="fl">2L</span>,  <span class="st">"1"</span>,     <span class="st">"1"</span>,
     <span class="fl">6L</span>,  <span class="fl">16L</span>,    <span class="fl">2L</span>,  <span class="st">"1"</span>,     <span class="st">"2"</span>,
     <span class="fl">7L</span>,  <span class="fl">17L</span>,    <span class="fl">5L</span>,  <span class="st">"1"</span>,     <span class="st">"1"</span>,
     <span class="fl">7L</span>,  <span class="fl">18L</span>,    <span class="fl">5L</span>,  <span class="st">"1"</span>,     <span class="st">"1"</span>,
     <span class="fl">7L</span>,  <span class="fl">19L</span>,    <span class="fl">5L</span>,  <span class="st">"1"</span>,     <span class="st">"2"</span>,
     <span class="fl">7L</span>,  <span class="fl">20L</span>,    <span class="fl">5L</span>,  <span class="st">"1"</span>,     <span class="st">"3"</span>,
     <span class="fl">7L</span>,  <span class="fl">21L</span>,    <span class="fl">5L</span>,  <span class="st">"1"</span>,     <span class="st">"3"</span>,
     <span class="fl">8L</span>,  <span class="fl">22L</span>,    <span class="fl">2L</span>,  <span class="st">"1"</span>,     <span class="st">"1"</span>,
     <span class="fl">8L</span>,  <span class="fl">23L</span>,    <span class="fl">2L</span>,  <span class="st">"1"</span>,     <span class="st">"2"</span>
  <span class="op">)</span>

<span class="va">individual_control</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">WKSTAT</span>,   <span class="op">~</span><span class="va">N</span>,
      <span class="st">"1"</span>,  <span class="fl">91L</span>,
      <span class="st">"2"</span>,  <span class="fl">65L</span>,
      <span class="st">"3"</span>, <span class="fl">104L</span>
  <span class="op">)</span>

<span class="va">group_control</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">CAR</span>,  <span class="op">~</span><span class="va">N</span>,
   <span class="st">"0"</span>, <span class="fl">35L</span>,
   <span class="st">"1"</span>, <span class="fl">65L</span>
  <span class="op">)</span></code></pre></div>
<p>First we need to create a <code>ml_problem</code> object which defines our multi-level fitting problem. <code><a href="reference/ml_problem.html">special_field_names()</a></code> is useful for the <code>field_names</code> argument to <code><a href="reference/ml_problem.html">ml_problem()</a></code>, this is where we need to specific the names of the ID columns in our reference sample and the count column in the control tables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitting_problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ml_problem.html">ml_problem</a></span><span class="op">(</span>
  ref_sample <span class="op">=</span> <span class="va">reference_sample</span>, 
  controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    individual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">individual_control</span><span class="op">)</span>,
    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">group_control</span><span class="op">)</span>
  <span class="op">)</span>,
  field_names <span class="op">=</span> <span class="fu"><a href="reference/ml_problem.html">special_field_names</a></span><span class="op">(</span>
    groupId <span class="op">=</span> <span class="st">"HHNR"</span>, 
    individualId <span class="op">=</span> <span class="st">"PNR"</span>, 
    count <span class="op">=</span> <span class="st">"N"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>You can use one of the <code>ml_fit_*()</code> functions to calibrate your fitting problem, or you can use <code>ml_fit(ml_problem, algorithm = "&lt;your-selected-algorithm&gt;")</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ml_fit.html">ml_fit</a></span><span class="op">(</span>ml_problem <span class="op">=</span> <span class="va">fitting_problem</span>, algorithm <span class="op">=</span> <span class="st">"ipu"</span><span class="op">)</span>
<span class="va">fit</span>
<span class="co">#&gt; An object of class ml_fit</span>
<span class="co">#&gt;   Algorithm: ipu</span>
<span class="co">#&gt;   Success: TRUE</span>
<span class="co">#&gt;   Residuals (absolute): min = -6.41906e-05, max = 0</span>
<span class="co">#&gt;   Flat problem:</span>
<span class="co">#&gt;   An object of class flat_ml_fit_problem</span>
<span class="co">#&gt;     Dimensions: 5 groups, 8 target values</span>
<span class="co">#&gt;     Model matrix type: separate</span>
<span class="co">#&gt;     Original fitting problem:</span>
<span class="co">#&gt;     An object of class ml_problem</span>
<span class="co">#&gt;       Reference sample: 23 observations</span>
<span class="co">#&gt;       Control totals: 1 at individual, and 1 at group level</span></code></pre></div>
<p><code>mlfit</code> also provides a function that helps to replicate the reference sample based on the fitted/calibrated weights. See <code><a href="reference/ml_replicate.html">?ml_replicate</a></code> to find out which integerisation algorithms are available.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">syn_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ml_replicate.html">ml_replicate</a></span><span class="op">(</span><span class="va">fit</span>, algorithm <span class="op">=</span> <span class="st">"trs"</span><span class="op">)</span>
<span class="va">syn_pop</span>
<span class="co">#&gt; # A tibble: 259 x 5</span>
<span class="co">#&gt;     HHNR   PNR  APER CAR   WKSTAT</span>
<span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; </span>
<span class="co">#&gt;  1     1     1     3 0     1     </span>
<span class="co">#&gt;  2     1     2     3 0     2     </span>
<span class="co">#&gt;  3     1     3     3 0     3     </span>
<span class="co">#&gt;  4     2     4     3 0     1     </span>
<span class="co">#&gt;  5     2     5     3 0     2     </span>
<span class="co">#&gt;  6     2     6     3 0     3     </span>
<span class="co">#&gt;  7     3     7     2 0     1     </span>
<span class="co">#&gt;  8     3     8     2 0     3     </span>
<span class="co">#&gt;  9     4     9     2 0     1     </span>
<span class="co">#&gt; 10     4    10     2 0     3     </span>
<span class="co">#&gt; # … with 249 more rows</span></code></pre></div>
</div>
<div id="example---multiple-zones" class="section level2">
<h2 class="hasAnchor">
<a href="#example---multiple-zones" class="anchor" aria-hidden="true"></a>Example - multiple zones</h2>
<p>This example is almost identical to the previous example, except we are creating sub-fitting problems based on zones. <code><a href="reference/ml_problem.html">ml_problem()</a></code> has the <code>geo_hierarchy</code> argument, where it lets you specify a geographical hierarchy, a <code>data.frame</code> with two columns: <code>region</code> and <code>zone</code>. To put it simply, a zone can only belong to one region. The image below shows an example of that, where the orange patch is a zone that is within the green region.</p>
<p><img src="https://user-images.githubusercontent.com/17020181/113852241-afed5580-97df-11eb-80ed-2b458e8fcbda.png"></p>
<p>When <code>geo_hierarchy</code> is validly specified, <code><a href="reference/ml_problem.html">ml_problem()</a></code> would return a list of fitting problems, one fitting problem per zone. Each fitting problem will contain only relevant subsets of the reference sample and control totals for its zone. Basically, the reference sample is a population survey sample taken at a regional level and the control totals should be at a zonal level.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ref_sample</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">HHNR</span>, <span class="op">~</span><span class="va">PNR</span>, <span class="op">~</span><span class="va">APER</span>, <span class="op">~</span><span class="va">HH_VAR</span>, <span class="op">~</span><span class="va">P_VAR</span>, <span class="op">~</span><span class="va">REGION</span>,
      <span class="fl">1</span>,    <span class="fl">1</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="fl">2</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="fl">3</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">2</span>,    <span class="fl">4</span>,     <span class="fl">2</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">2</span>,    <span class="fl">5</span>,     <span class="fl">2</span>,       <span class="fl">1</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">3</span>,    <span class="fl">6</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">3</span>,    <span class="fl">7</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">3</span>,    <span class="fl">8</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">4</span>,    <span class="fl">9</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">4</span>,   <span class="fl">10</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">4</span>,   <span class="fl">11</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">5</span>,   <span class="fl">12</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">5</span>,   <span class="fl">13</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">5</span>,   <span class="fl">14</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">6</span>,   <span class="fl">15</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">6</span>,   <span class="fl">16</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">7</span>,   <span class="fl">17</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">7</span>,   <span class="fl">18</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">7</span>,   <span class="fl">19</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">7</span>,   <span class="fl">20</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">7</span>,   <span class="fl">21</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">1</span>,
      <span class="fl">8</span>,   <span class="fl">22</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">1</span>,
      <span class="fl">8</span>,   <span class="fl">23</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">1</span>,
      <span class="fl">9</span>,   <span class="fl">24</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
      <span class="fl">9</span>,   <span class="fl">25</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">2</span>,       <span class="fl">2</span>,
      <span class="fl">9</span>,   <span class="fl">26</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">10</span>,   <span class="fl">27</span>,     <span class="fl">2</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">10</span>,   <span class="fl">28</span>,     <span class="fl">2</span>,       <span class="fl">1</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">11</span>,   <span class="fl">29</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">11</span>,   <span class="fl">30</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">11</span>,   <span class="fl">31</span>,     <span class="fl">3</span>,       <span class="fl">1</span>,      <span class="fl">2</span>,       <span class="fl">2</span>,
     <span class="fl">12</span>,   <span class="fl">32</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">12</span>,   <span class="fl">33</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">12</span>,   <span class="fl">34</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">13</span>,   <span class="fl">35</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">2</span>,
     <span class="fl">13</span>,   <span class="fl">36</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">2</span>,
     <span class="fl">13</span>,   <span class="fl">37</span>,     <span class="fl">3</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">14</span>,   <span class="fl">38</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">14</span>,   <span class="fl">39</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">2</span>,
     <span class="fl">15</span>,   <span class="fl">40</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">15</span>,   <span class="fl">41</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">15</span>,   <span class="fl">42</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">2</span>,
     <span class="fl">15</span>,   <span class="fl">43</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">15</span>,   <span class="fl">44</span>,     <span class="fl">5</span>,       <span class="fl">2</span>,      <span class="fl">3</span>,       <span class="fl">2</span>,
     <span class="fl">16</span>,   <span class="fl">45</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,       <span class="fl">2</span>,
     <span class="fl">16</span>,   <span class="fl">46</span>,     <span class="fl">2</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,       <span class="fl">2</span>
  <span class="op">)</span>


<span class="va">hh_ctrl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">ZONE</span>, <span class="op">~</span><span class="va">HH_VAR</span>, <span class="op">~</span><span class="va">N</span>,
  <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">35</span>,
  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">35</span>,
  <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">35</span>,
  <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">35</span>,
  <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">65</span>
<span class="op">)</span>

<span class="va">ind_ctrl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">ZONE</span>, <span class="op">~</span><span class="va">P_VAR</span>, <span class="op">~</span><span class="va">N</span>,
  <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">91</span>,
  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">104</span>,
  <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">91</span>,
  <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">104</span>,
  <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">91</span>,
  <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">104</span>,
  <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">91</span>,
  <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">65</span>,
  <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">104</span>
<span class="op">)</span>

<span class="va">geo_hierarchy</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">REGION</span>, <span class="op">~</span><span class="va">ZONE</span>,
  <span class="fl">1</span>, <span class="fl">1</span>,
  <span class="fl">1</span>, <span class="fl">2</span>,
  <span class="fl">2</span>, <span class="fl">3</span>,
  <span class="fl">2</span>, <span class="fl">4</span>
<span class="op">)</span>

<span class="va">fitting_problems</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ml_problem.html">ml_problem</a></span><span class="op">(</span>
    ref_sample <span class="op">=</span> <span class="va">ref_sample</span>,
    field_names <span class="op">=</span> <span class="fu"><a href="reference/ml_problem.html">special_field_names</a></span><span class="op">(</span>
      groupId <span class="op">=</span> <span class="st">"HHNR"</span>, individualId <span class="op">=</span> <span class="st">"PNR"</span>, count <span class="op">=</span> <span class="st">"N"</span>,
      zone <span class="op">=</span> <span class="st">"ZONE"</span>, region <span class="op">=</span> <span class="st">"REGION"</span>
    <span class="op">)</span>,
    group_controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">hh_ctrl</span><span class="op">)</span>,
    individual_controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ind_ctrl</span><span class="op">)</span>,
    geo_hierarchy <span class="op">=</span> <span class="va">geo_hierarchy</span>
  <span class="op">)</span>
<span class="co">#&gt; Creating a list of fitting problems by zone</span>

<span class="va">fits</span> <span class="op">&lt;-</span> <span class="va">fitting_problems</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ml_fit</span>, algorithm <span class="op">=</span> <span class="st">"ipu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ml_replicate</span>, algorithm <span class="op">=</span> <span class="st">"trs"</span><span class="op">)</span></code></pre></div>
</div>
<div id="powered-by" class="section level2">
<h2 class="hasAnchor">
<a href="#powered-by" class="anchor" aria-hidden="true"></a>Powered by</h2>
<ul>
<li>
<a href="https://krlmlr.github.io/grake/" class="external-link"><code>grake</code></a>: A reimplementation of generalized raking (<a href="https://amstat.tandfonline.com/doi/abs/10.1080/01621459.1992.10475217" class="external-link">Deville and Särndal, 1992</a>; <a href="https://www.tandfonline.com/doi/abs/10.1080/01621459.1993.10476369" class="external-link">Deville, Särndal and Sautory, 1993</a>)</li>
</ul>
</div>
<div id="related-work" class="section level2">
<h2 class="hasAnchor">
<a href="#related-work" class="anchor" aria-hidden="true"></a>Related work</h2>
<ul>
<li>
<a href="https://krlmlr.github.io/wrswoR/" class="external-link"><code>wrswoR</code></a>: An implementation of fast weighted random sampling without replacement (<a href="https://www.sciencedirect.com/science/article/pii/S002001900500298X" class="external-link">Efraimidis and Spirakis, 2006</a>)</li>
<li>
<a href="https://krlmlr.github.io/mangow/" class="external-link"><code>mangow</code></a>: Embed the Gower distance metric in L1</li>
<li>
<a href="https://github.com/jefferislab/RANN/tree/master-L1" class="external-link"><code>RANN.L1</code></a>: k-nearest neighbors using the L1 metric</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor" aria-hidden="true"></a>Installation</h2>
<p>The package is not currently on CRAN, but can be installed from GitHub with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mlfit/mlfit"</span><span class="op">)</span></code></pre></div>
<div id="where-is-multilevelipf" class="section level3">
<h3 class="hasAnchor">
<a href="#where-is-multilevelipf" class="anchor" aria-hidden="true"></a>Where is <code>MultiLeveLIPF</code>?</h3>
<p>From version <code>0.4.0</code> onwards the package is now to be known as <code>mlfit</code>. If you would like to install any version that is older than <code>0.4.0</code> please use:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># See https://github.com/mlfit/mlfit/releases for the releases that are available</span>
<span class="co"># To install a certain branch or commit or tag, append it to the repo name, after an @:</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mlfit/mlfit@v0.3-7"</span><span class="op">)</span></code></pre></div>
<p>Note that, all versions prior to <code>0.4.0</code> should be used as <code>MultiLeveLIPF</code> not <code>mlfit</code>.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/mlfit/mlfit/">https://​github.com/​mlfit/​mlfit/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/mlfit/mlfit/issues">https://​github.com/​mlfit/​mlfit/​issues</a>
</li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kirill Müller <br><small class="roles"> Author, copyright holder </small>  </li>
<li>Amarin Siripanich <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More on authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mlfit/mlfit/actions" class="external-link"><img src="https://github.com/mlfit/mlfit/workflows/rcc/badge.svg" alt="rcc"></a></li>
<li><a href="https://codecov.io/github/mlfit/mlfit?branch=master" class="external-link"><img src="https://codecov.io/github/mlfit/mlfit/coverage.svg?branch=master" alt="codecov.io"></a></li>
<li><a href="https://codecov.io/gh/mlfit/mlfit?branch=master" class="external-link"><img src="https://codecov.io/gh/mlfit/mlfit/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Kirill Müller, Amarin Siripanich.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
